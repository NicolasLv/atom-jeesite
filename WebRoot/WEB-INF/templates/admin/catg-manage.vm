#set($layout="/layout/layout-admin.vm")
#set($title="分类管理 - 后台管理")
<link rel="stylesheet" type="text/css" href="$ctx/public/zTreeStyle/zTreeStyle.css" />
<script type="text/javascript" src="$ctx/public/js/jquery.ztree.all-3.5.js"></script>
<script type="text/javascript">
<!--
#set($catgs = $CatgXHelper.findAllCatgs())
#set($count = $catgs.size())
var ztreeNodes = [
#foreach($catg in $catgs)
	{id:$catg.id, pId:$catg.catg, catg:$catg.catg, name:"($catg.id)($EnumXHelper.toTrueFalseEnum($catg.top).code())($catg.sort)($catg.name)", sname:"$catg.name", open:true, top:"$catg.top", sort:$catg.sort} #if($velocityCount<$count),#end
#end
];
	
function onTreeCatgsClick(evt, treeId, catg, clickFlag) {
	if(clickFlag !== 1) {
		alert("请单选一个主题分类!");
		return;
	}
	
	$("#catgId").val(catg.id);
	$("#catgName").val(catg.sname);
};

var ztreeSetting = {
	view: {
		dblClickExpand: false
	},
	data: {
		simpleData: {
			enable: true
		}
	},
	callback: {
		onClick: onTreeCatgsClick
	}
};

$(document).ready(function(){
	$.fn.zTree.init($("#ztreeCatgs"), ztreeSetting, ztreeNodes);
	
	$("#btn-refresh").click(function(e) {
		location.href = "$ctx/admin/catg/manage.html";
	});
	
	$("#btn-update").click(function(e) {
		e.preventDefault();
		location.href = "$ctx/admin/catg/update-" + $("#catgId").val() + ".html";
	});
});
//-->
</script>
<div class="radius-block">
    <div class="well well-small" style="margin-bottom:0px">
        <form id="catg-form" name="catg-form" class="form-inline" style="margin-bottom:0px">
			<button id="btn-refresh" type="button" class="btn btn-info"><span class="icon-refresh"></span> 刷新</button>
			
			<div class="pull-right">
    			<input type="hidden" id="catgId" name="catgId" />
    			<input type="text" id="catgName" name="catgName" class="input-medium" readonly="readonly" placeholder="分类名称" />
    			<button type="button" id="btn-update" class="btn btn-success">修改分类</button>
			</div>
        </form>
    </div>
	<div id="ztreeCatgs" class="ztree"></div>
	<div class="clearfix"></div>
</div>
<div class="clearfix"></div>
